# EPPIonization.jl

Generate D-region charge density profiles resulting from ionization from energetic particle precipitation (EPP).

This package interpolates across a lookup table of Monte Carlo modeling results for the ionization generated by EPP. It is based on code written by Wei Xu (see [Citations](#citations) below).

NRLMSISE-00 and [FaradayInternationalReferenceIonosphere.jl](https://github.com/fgasdia/FaradayInternationalReferenceIonosphere.jl) are used to generate neutral profiles and electron density profiles for the specified `DateTime`, latitude, and longitude. The [GPI](https://github.com/fgasdia/GPILowerIonosphere.jl) model is used to generate the resulting charge density profiles for the lower ionosphere. If a precipitating electron flux is specified, GPI will incorporate the appropriate ionization profile. 

## Usage

```julia
using Dates, EPPIonization
using LMPTools  # using Pkg; Pkg.add("https://github.com/fgasdia/LMPTools.jl")

z = 0:110  # altitudes in km
dt = DateTime(2020, 1, 1, 2, 30)
lat, lon = 60, 258
flux = 1e5  # electron flux in el/cm²/s

daytime = isday(zenithangle(lat, lon, dt))

# Compute table of profiles `np` with columns of height `h` in kilometers,
# electron density `Ne` in m⁻³ from FIRI,
# neutral temperature `Tn` in Kelvin, and densities of neutral `O`, `N2`, and `O2` in m⁻³,
# both from NRLMSISE-00.
np = neutralprofiles(lat, lon, z, dt)

# Without specifying flux, `chargeprofiles` returns only the GPI-derived background profiles.
bp = chargeprofiles(lat, lon, z, dt)
bp = chargeprofiles(np, z, daytime)

# When specifying the flux, we get the GPI-derived background and EPP-perturbed profiles.
bp, epp = chargeprofiles(flux, lat, lon, z, dt)
bp, epp = chargeprofiles(flux, np, z, daytime)
```

## Citations

This code is based on

    Xu, Wei, Marshall, Robert A, Tyssoy, Hilde Nesse, & Fang, Xiaohua. (2020). A Generalized Method for Calculating Atmospheric Ionization by Energetic Electron Precipitation. https://doi.org/10.5281/zenodo.3945306

The original Matlab source code is available at https://zenodo.org/record/3945306 under [Creative Commons Attribution 4.0 International](https://creativecommons.org/licenses/by/4.0/legalcode) license.
